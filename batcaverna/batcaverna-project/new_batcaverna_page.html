<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>batcarverna - PVRV</title>

    <!-- IMPORT Tailwind and Google Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fira+Code&display=swap" rel="stylesheet">

    <!-- IMPORT DEPEDENCES in NPM -->
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "htm": "https://esm.sh/htm@3.1.1",
                "three": "https://cdn.jsdelivr.net/npm/three@0.148.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.148.0/examples/jsm/",
                "chart.js": "https://esm.sh/chart.js@4.4.0",
                "chart.js/auto": "https://esm.sh/chart.js@4.4.0/auto"
            }
        }
    </script>

    <style>
        :root {
            --bg-dark: #000000;
            --bg-panel: rgba(1, 1, 16, 0.948);
            --border-color: rgba(0, 221, 255, 0.5);
            --neon-cyan: #00e5ff;
            --text-primary: #e6f7ff;
            --text-secondary: #8b949e;
            --kanban-backlog: #4a5568;
            --kanban-todo: #4299e1;
            --kanban-progress: #f6ad55;
            --kanban-completed: #48bb78;
            --skill-xp-bar: linear-gradient(90deg, #00ff88 0%, #00e5ff 100%);
            --skill-unlocked: #00ff88;
            --skill-locked: #4a5568;
            --batman-yellow: #ffd700;
            --batman-gray: #1a1a1a;
        }

        html, body, #root {
            height: 100%;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        .glass-panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25), inset 0 0 20px rgba(0, 229, 255, 0.05);
            backdrop-filter: blur(12px);
            border-radius: 0.9rem;
        }

        .neon-text {
            text-shadow: 0 0 4px var(--neon-cyan), 0 0 8px var(--neon-cyan), 0 0 15px rgba(0, 229, 255, 0.4);
        }

        .tab-btn {
            background-color: transparent;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease-in-out;
            padding: 0.5rem 1.2rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .tab-btn:hover {
            background-color: rgba(0, 229, 255, 0.05);
            color: var(--text-primary);
        }

        .tab-btn.active {
            color: var(--neon-cyan);
            border-bottom-color: var(--neon-cyan);
            text-shadow: 0 0 5px var(--neon-cyan);
        }

        .profile-tab-btn {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid transparent;
            transition: all 0.2s ease-in-out;
            padding: 0.5rem 1.5rem;
            color: var(--text-secondary);
            font-weight: 600;
            border-radius: 0.5rem;
        }

        .profile-tab-btn:hover {
            background-color: rgba(255, 215, 0, 0.1);
            border-color: var(--batman-yellow);
            color: var(--batman-yellow);
        }

        .profile-tab-btn.active {
            background-color: rgba(255, 215, 0, 0.2);
            border-color: var(--batman-yellow);
            color: var(--batman-yellow);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .batman-card {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(10, 10, 10, 0.9) 100%);
            border: 1px solid var(--batman-yellow);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 0 20px rgba(255, 215, 0, 0.05);
            border-radius: 0.75rem;
        }

        .batman-progress-bar {
            background: linear-gradient(90deg, #ffd700 0%, #ffed4e 100%);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .batman-binary {
            font-family: 'Fira Code', monospace;
            color: var(--batman-yellow);
            opacity: 0.7;
        }

        .xp-progress-bar {
            background: var(--skill-xp-bar);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .skill-card {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .skill-card:hover {
            border-color: var(--neon-cyan);
            transform: translateY(-2px);
        }

        .skill-card.unlocked {
            border-color: var(--skill-unlocked);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);
        }

        .skill-card.locked {
            border-color: var(--skill-locked);
            opacity: 0.7;
        }

        .routine-time {
            font-family: 'Fira Code', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .markdown-editor {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 204, 0.1);
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.8;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--neon-cyan);
        }

        .kanban-column-drag-over {
            background-color: rgba(0, 229, 255, 0.1);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';
        import htm from 'htm';
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import Chart from 'chart.js/auto';

        const html = htm.bind(React.createElement);

        // =======================================================
        // ! DASHBOARD APP WIDGET - CLASSE √öNICA / STORAGE / MODEL
        // =======================================================

        class DashboardAppWidget {
            static get(key, defaultValue) {
                const storedValue = localStorage.getItem(key);
                if (storedValue === null || storedValue === "null") {
                    return defaultValue;
                }
                try {
                    return storedValue ? JSON.parse(storedValue) : defaultValue;
                } catch (e) {
                    return storedValue || defaultValue;
                }
            }

            static set(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            }

            static formatDate(date) {
                return date.toLocaleDateString('pt-BR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            static formatTime(date) {
                return date.toLocaleTimeString('pt-BR');
            }
        }

        const TASK_STORAGE_KEY = 'dashboard-tasks-v3';
        const SKILLS_STORAGE_KEY = 'dashboard-skills-v1';
        const GITHUB_MARKDOWN_URL = "https://raw.githubusercontent.com/PedroVic12/Pikachu-Flask-Server/refs/heads/main/batcaverna/batcaverna_pv.md";
        const DEFAULT_TASKS_MD = `# ü¶á Projetos Bat-Caverna __IN_PROGRESS\n- [ ] Carregando dados do GitHub...`;

        class StorageController {
            static get(key, defaultValue) {
                const storedValue = localStorage.getItem(key);
                if (storedValue === null || storedValue === "null") {
                    return defaultValue;
                }
                try {
                    return storedValue ? JSON.parse(storedValue) : defaultValue;
                } catch (e) {
                    return storedValue || defaultValue;
                }
            }
            static set(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            }
        }

        class DashboardModel {
            async fetchAndProcessMarkdown() {
                try {
                    const response = await fetch(GITHUB_MARKDOWN_URL);
                    if (!response.ok) throw new Error('Failed to fetch markdown');
                    let markdown = await response.text();
                    markdown = markdown.replace(/\[([xX])\]/g, '[x]');
                    return this.parseTasksFromMarkdown(markdown);
                } catch (error) {
                    console.error('Error fetching markdown:', error);
                    return this.parseTasksFromMarkdown(DEFAULT_TASKS_MD);
                }
            }

            parseTasksFromMarkdown(markdown) {
                if (!markdown) return [];
                const mdString = String(markdown);
                const categories = mdString.split(/^#\s+/m).slice(1);
                const KANBAN_TAGS = ['BACKLOG', 'TODO', 'IN_PROGRESS', 'COMPLETED'];

                return categories.map(cat => {
                    const lines = cat.trim().split('\n');
                    const header = lines[0].trim();

                    let label = header;
                    let explicitStatus = null;

                    const tagMatch = header.match(/__([A-Z_]+)$/);
                    if (tagMatch && KANBAN_TAGS.includes(tagMatch[1])) {
                        explicitStatus = tagMatch[1];
                        label = header.replace(tagMatch[0], '').trim();
                    }

                    const taskLines = lines.slice(1).filter(line => line.match(/^\s*-\s*\[[ x]\]/i));
                    const items = taskLines.map(line => {
                        const isChecked = line.match(/^\s*-\s*\[x\]/i);
                        const text = line.replace(/^\s*-\s*\[[ x]\]\s*/i, '').trim();
                        return {
                            completed: !!isChecked,
                            text: text
                        };
                    });

                    const hasTasks = items.length > 0;
                    if (!hasTasks) return null;

                    const completedCount = items.filter(item => item.completed).length;
                    const progress = hasTasks ? Math.round((completedCount / items.length) * 100) : 0;

                    const status = explicitStatus || (progress === 100 ? 'COMPLETED' : progress > 0 ? 'IN_PROGRESS' : 'TODO');
                    const color = progress > 70 ? '#39ff14' : progress > 40 ? '#00e5ff' : progress > 10 ? '#ffab00' : '#f44336';

                    return { label, progress, color, items, status };
                }).filter(Boolean);
            }

            getAstroData() {
                const now = new Date();
                const knownNewMoon = new Date('2000-01-06T18:14:00Z');
                const daysSinceNewMoon = (now - knownNewMoon) / 86400000;
                const LUNAR_CYCLE = 29.53058867;
                const currentCyclePos = (daysSinceNewMoon / LUNAR_CYCLE) % 1;
                const phaseIndex = Math.floor(currentCyclePos * 8 + 0.5) % 8;
                const moonPhases = [{ name: "Lua Nova", emoji: "üåë" }, { name: "Crescente", emoji: "üåí" }, { name: "Quarto Crescente", emoji: "üåì" }, { name: "Gibosa Crescente", emoji: "üåî" }, { name: "Lua Cheia", emoji: "üåï" }, { name: "Gibosa Minguante", emoji: "üåñ" }, { name: "Quarto Minguante", emoji: "üåó" }, { name: "Minguante", emoji: "üåò" }];

                const hour = now.getHours();
                let score = 50;
                if ((hour >= 5 && hour <= 8) || (hour >= 17 && hour <= 20)) { score += 40; }
                if ((hour >= 11 && hour <= 14) || (hour >= 23 || hour <= 2)) { score += 20; }
                if (phaseIndex === 0 || phaseIndex === 4) { score += 30; }
                else if (phaseIndex === 2 || phaseIndex === 6) { score += 15; }
                score = Math.min(100, score);
                let fishingForecast;
                if (score > 85) fishingForecast = { text: "Excelente", color: "text-cyan-400" };
                else if (score > 65) fishingForecast = { text: "Bom", color: "text-green-400" };
                else if (score > 40) fishingForecast = { text: "Regular", color: "text-yellow-400" };
                else fishingForecast = { text: "Fraco", color: "text-red-400" };

                const constellationsByMonth = { 0: [{ name: "√ìrion", emoji: "üèπ" }, { name: "C√£o Maior", emoji: "üêï" }], 1: [{ name: "G√™meos", emoji: "‚ôä" }, { name: "Carina", emoji: "‚õµÔ∏è" }], 2: [{ name: "Le√£o", emoji: "ü¶Å" }, { name: "Cruzeiro do Sul", emoji: "‚úùÔ∏è" }], 3: [{ name: "Cruzeiro do Sul", emoji: "‚úùÔ∏è" }, { name: "Virgem", emoji: "‚ôç" }], 4: [{ name: "Centauro", emoji: "üêé" }, { name: "Balan√ßa", emoji: "‚öñÔ∏è" }], 5: [{ name: "Escorpi√£o", emoji: "ü¶Ç" }, { name: "Sagit√°rio", emoji: "‚ôê" }], 6: [{ name: "Escorpi√£o", emoji: "ü¶Ç" }, { name: "√Åguia", emoji: "ü¶Ö" }], 7: [{ name: "Sagit√°rio", emoji: "‚ôê" }, { name: "Capric√≥rnio", emoji: "‚ôë" }], 8: [{ name: "Aqu√°rio", emoji: "‚ôí" }, { name: "Grou", emoji: "üê¶" }], 9: [{ name: "Peixes", emoji: "‚ôì" }, { name: "F√™nix", emoji: "üî•" }], 10: [{ name: "√Åries", emoji: "‚ôà" }, { name: "Baleia", emoji: "üê≥" }], 11: [{ name: "Touro", emoji: "üêÇ" }, { name: "√ìrion", emoji: "üèπ" }] };

                return {
                    moonPhase: moonPhases[phaseIndex],
                    fishingForecast,
                    constellations: constellationsByMonth[now.getMonth()] || []
                };
            }
        }

        // =======================================================
        // SKILLS SYSTEM
        // =======================================================

        const DEFAULT_SKILLS_DATA = {
            currentXP: 9311,
            totalXP: 45000,
            level: 7,
            improvementPoints: 1,
            unlockedSkills: [
                { id: 'combat1', name: 'Combate Corporal B√°sico', category: 'combat', description: 'Aumenta dano em 10%', level: 1, maxLevel: 5 },
                { id: 'stealth1', name: 'Camuflagem Noturna', category: 'stealth', description: 'Reduz detec√ß√£o em 20%', level: 1, maxLevel: 3 },
            ],
            availableSkills: [
                { id: 'combat2', name: 'Contra-ataque R√°pido', category: 'combat', description: 'Chance de contra-ataque', xpCost: 1500, requiredLevel: 8 },
                { id: 'stealth2', name: 'Movimento Silencioso', category: 'stealth', description: 'Reduz ru√≠do em 30%', xpCost: 1200, requiredLevel: 7 },
                { id: 'aux1', name: 'Scanner Aprimorado', category: 'auxiliary', description: 'Detecta inimigos a 50m', xpCost: 1800, requiredLevel: 9 },
            ],
            objectives: [
                { id: 'obj1', name: 'Alcan√ßar N√≠vel 10', description: 'Suba para o n√≠vel 10', xpReward: 2000, completed: false },
                { id: 'obj2', name: 'Desbloquear 5 Habilidades', description: 'Desbloqueie 5 habilidades diferentes', xpReward: 1500, completed: false, current: 2, target: 5 },
                { id: 'obj3', name: 'Completar Rotina Di√°ria 7x', description: 'Complete sua rotina di√°ria 7 vezes', xpReward: 1000, completed: false, current: 3, target: 7 },
            ],
            dailyRoutines: [
                { id: 'morning', name: 'Rotina Matinal', time: '06:00-08:00', tasks: ['Acordar cedo', 'Medita√ß√£o 15min', 'Planejar dia'], completed: true },
                { id: 'work', name: 'Trabalho Focado', time: '09:00-12:00', tasks: ['C√≥digo 3h', 'Revisar projetos'], completed: false },
                { id: 'study', name: 'Estudos T√©cnicos', time: '14:00-16:00', tasks: ['Sistemas de Pot√™ncia', 'Programa√ß√£o React'], completed: false },
                { id: 'evening', name: 'Rotina Noturna', time: '20:00-22:00', tasks: ['Revisar dia', 'Planejar amanh√£', 'Leitura'], completed: false },
            ],
            skillCategories: [
                { id: 'combat', name: 'Combate Corporal', total: 21, unlocked: 4 },
                { id: 'stealth', name: 'Predador Invis√≠vel', total: 23, unlocked: 3 },
                { id: 'auxiliary', name: 'Auxiliares', total: 15, unlocked: 2 },
            ]
        };

        function useSkillsController() {
            const [skillsData, setSkillsData] = useState(() => {
                return StorageController.get(SKILLS_STORAGE_KEY, DEFAULT_SKILLS_DATA);
            });

            const xpPercentage = Math.round((skillsData.currentXP / skillsData.totalXP) * 100);
            const xpToNextLevel = skillsData.totalXP - skillsData.currentXP;

            const unlockSkill = (skillId) => {
                setSkillsData(prev => {
                    const skill = prev.availableSkills.find(s => s.id === skillId);
                    if (!skill || prev.improvementPoints <= 0 || prev.currentXP < skill.xpCost || prev.level < skill.requiredLevel) {
                        return prev;
                    }

                    const newUnlocked = {
                        id: skill.id,
                        name: skill.name,
                        category: skill.category,
                        description: skill.description,
                        level: 1,
                        maxLevel: skill.maxLevel || 3
                    };

                    const updatedSkills = {
                        ...prev,
                        improvementPoints: prev.improvementPoints - 1,
                        currentXP: prev.currentXP - skill.xpCost,
                        unlockedSkills: [...prev.unlockedSkills, newUnlocked],
                        availableSkills: prev.availableSkills.filter(s => s.id !== skillId)
                    };

                    StorageController.set(SKILLS_STORAGE_KEY, updatedSkills);
                    return updatedSkills;
                });
            };

            const completeRoutine = (routineId) => {
                setSkillsData(prev => {
                    const updatedRoutines = prev.dailyRoutines.map(routine => 
                        routine.id === routineId ? { ...routine, completed: true } : routine
                    );

                    const xpGained = 250; // XP por rotina completada
                    
                    const updatedSkills = {
                        ...prev,
                        dailyRoutines: updatedRoutines,
                        currentXP: prev.currentXP + xpGained,
                        objectives: prev.objectives.map(obj => {
                            if (obj.id === 'obj3') {
                                const newCurrent = (obj.current || 0) + 1;
                                return {
                                    ...obj,
                                    current: newCurrent,
                                    completed: newCurrent >= obj.target
                                };
                            }
                            return obj;
                        })
                    };

                    StorageController.set(SKILLS_STORAGE_KEY, updatedSkills);
                    return updatedSkills;
                });
            };

            const resetDailyRoutines = () => {
                setSkillsData(prev => {
                    const updatedSkills = {
                        ...prev,
                        dailyRoutines: prev.dailyRoutines.map(routine => ({
                            ...routine,
                            completed: false
                        }))
                    };
                    StorageController.set(SKILLS_STORAGE_KEY, updatedSkills);
                    return updatedSkills;
                });
            };

            const completeObjective = (objectiveId) => {
                setSkillsData(prev => {
                    const objective = prev.objectives.find(obj => obj.id === objectiveId);
                    if (!objective || objective.completed) return prev;

                    const updatedSkills = {
                        ...prev,
                        objectives: prev.objectives.map(obj => 
                            obj.id === objectiveId ? { ...obj, completed: true } : obj
                        ),
                        currentXP: prev.currentXP + objective.xpReward
                    };

                    StorageController.set(SKILLS_STORAGE_KEY, updatedSkills);
                    return updatedSkills;
                });
            };

            return {
                skillsData,
                xpPercentage,
                xpToNextLevel,
                unlockSkill,
                completeRoutine,
                resetDailyRoutines,
                completeObjective
            };
        }

        // =======================================================
        // ! DASHBOARD CONTROLLER
        // =======================================================

        function useDashboardController() {
            const model = useMemo(() => new DashboardModel(), []);
            const [activeView, setActiveView] = useState('kanban');
            const [currentTime, setCurrentTime] = useState('');
            const [astroData, setAstroData] = useState({ moonPhase: {}, fishingForecast: {}, constellations: [] });
            const [tasksMarkdown, setTasksMarkdown] = useState(() => StorageController.get(TASK_STORAGE_KEY, DEFAULT_TASKS_MD));
            const tasks = useMemo(() => model.parseTasksFromMarkdown(tasksMarkdown), [tasksMarkdown, model]);

            useEffect(() => {
                const fetchMarkdown = async () => {
                    try {
                        console.log("üì° Buscando markdown do GitHub...");
                        const response = await fetch(GITHUB_MARKDOWN_URL + `?cachebust=${new Date().getTime()}`);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const text = await response.text();

                        console.log('‚úÖ Conte√∫do recebido do GitHub:', text.length, 'caracteres');

                        setTasksMarkdown(currentMarkdown => {
                            if (text !== currentMarkdown) {
                                StorageController.set(TASK_STORAGE_KEY, text);
                                return text;
                            }
                            return currentMarkdown;
                        });

                    } catch (error) {
                        console.error("‚ùå Erro ao buscar markdown do GitHub, usando dados locais:", error.message);
                    }
                };

                fetchMarkdown();
                const pollInterval = setInterval(fetchMarkdown, 60000);
                return () => clearInterval(pollInterval);
            }, []);

            useEffect(() => {
                const intervalId = setInterval(() => {
                    setCurrentTime(new Date().toLocaleTimeString('pt-BR'));
                    setAstroData(model.getAstroData());
                }, 1000);
                setCurrentTime(new Date().toLocaleTimeString('pt-BR'));
                setAstroData(model.getAstroData());
                return () => clearInterval(intervalId);
            }, [model]);

            const handleMarkdownChange = (e) => {
                const newMarkdown = e.target.value;
                setTasksMarkdown(newMarkdown);
                StorageController.set(TASK_STORAGE_KEY, newMarkdown);
            };

            const handleKanbanUpdate = (cardLabel, newStatus) => {
                const KANBAN_TAGS_REGEX = /__([A-Z_]+)$/;
                const lines = tasksMarkdown.split('\n');
                const categoryIndex = lines.findIndex(line => line.trim().startsWith(`# ${cardLabel}`));

                if (categoryIndex !== -1) {
                    let headerLine = lines[categoryIndex];
                    headerLine = headerLine.replace(KANBAN_TAGS_REGEX, '').trim();
                    lines[categoryIndex] = `${headerLine} __${newStatus}`;

                    const newMarkdown = lines.join('\n');
                    setTasksMarkdown(newMarkdown);
                    StorageController.set(TASK_STORAGE_KEY, newMarkdown);
                }
            };

            return { activeView, setActiveView, currentTime, ...astroData, tasks, tasksMarkdown, handleMarkdownChange, handleKanbanUpdate };
        }

        // =======================================================
        // UI COMPONENTS (SIDEBAR)
        // =======================================================

        const Header = ({ currentTime }) => {
            const now = new Date();
            const DataAtual = `${now.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`;
            return html`
                <header>
                    <h1 className="text-3xl font-bold neon-text">Bat Caverna Dashboard ü¶á</h1>
                    <p className="text-sm text-gray-400">${DataAtual}</p>
                    <div className="flex justify-between items-center mt-4">
                        <h2 className="font-semibold text-gray-300">Hor√°rio Local</h2>
                        <span className="font-mono text-lg bg-black/20 px-2 rounded">${currentTime}</span>
                    </div>
                </header>`;
        };

        const WeeklyFocus = ({ tasks }) => html`
            <section className="bg-black/20 p-3 rounded-lg">
                <h2 className="font-semibold text-gray-300 mb-2">üéØ Foco da Semana</h2>
                <ul className="space-y-2">${tasks.map(task => html`
                    <li key=${task.label} className="text-lg">
                        <div className="flex justify-between mb-1">
                            <span className="text-gray-300">${task.label}</span>
                            <span className="text-gray-500">${task.progress}%</span>
                        </div>
                        <div className="w-full bg-black/30 rounded-full h-1.5">
                            <div className="h-1.5 rounded-full" style=${{ width: `${task.progress}%`, backgroundColor: task.color }}></div>
                        </div>
                    </li>`)}
                </ul>
            </section>`;

        const LinksPanel = () => {
            const [expandedGroups, setExpandedGroups] = React.useState({
                redes: true,
                apps: true,
                projetos: false,
                entretenimento: false
            });

            const toggleGroup = (group) => {
                setExpandedGroups(prev => ({
                    ...prev,
                    [group]: !prev[group]
                }));
            };

            const linkSections = [
                {
                    id: 'redes',
                    title: 'üîó Redes Sociais',
                    links: [
                        { url: 'https://github.com/PedroVic12', text: 'üåç GitHub' },
                        { url: 'https://linkedin.com/in/pedrovictor12', text: 'üíº LinkedIn', variant: 'bg-blue-600' },
                    ]
                },
                {
                    id: 'apps',
                    title: 'üì± Aplicativos',
                    links: [
                        { url: 'PVRV/Gohan_treinamentos_2025.html', text: 'üí™ App Produtividade' },
                        { url: 'https://gohann-treinamentos-web-app-one.vercel.app', text: 'üìö Ionic Gohan Treinamentos' },
                    ]
                },
                {
                    id: 'projetos',
                    title: '‚öôÔ∏è Projetos',
                    links: [
                        { url: 'http://127.0.0.1:5000/', text: 'üöÄ Pikachu API Server' },
                        { url: 'https://electrical-system-simulator.vercel.app/', text: '‚ö° SEP para Leigos' },
                        {url: "PVRV/Habit_Tracker.html", text: "üìä Habit Tracker XP"},
                    ]
                },
                {
                    id: 'entretenimento',
                    title: 'üéÆ Entretenimento',
                    links: [
                        { url: 'https://www.mat.ufmg.br/futebol/classificacao-para-libertadores_seriea/', text: '‚öΩ Prob. Futebol', variant: 'bg-green-700' },
                        { url: 'outro_arquivo.html', text: 'üìÑ Outros Links' },
                    ]
                }
            ];

            return html`
                <div className="bg-black/30 backdrop-blur-sm p-4 rounded-xl border border-gray-700/50 shadow-lg">
                    <div className="flex items-center justify-between mb-4 p-2 bg-black/30 rounded-lg">
                        <h2 className="font-bold text-xl text-gray-200">üîó Painel de Links</h2>
                        <div className="text-sm text-gray-400">${linkSections.flatMap(g => g.links).length} links</div>
                    </div>
                    
                    <div className="space-y-3">
                        ${linkSections.map(section => html`
                            <div key=${section.id} className="bg-black/20 rounded-lg overflow-hidden">
                                <button 
                                    onClick=${() => toggleGroup(section.id)}
                                    className="w-full px-4 py-3 text-left font-medium text-gray-200 bg-black/30 hover:bg-black/40 transition-colors flex items-center justify-between"
                                >
                                    <span>${section.title}</span>
                                    <span className="transform transition-transform ${expandedGroups[section.id] ? 'rotate-180' : ''} text-gray-400">
                                        ‚ñº
                                    </span>
                                </button>
                                ${expandedGroups[section.id] ? html`
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 p-3">
                                        ${section.links.map((link, i) => html`
                                            <a 
                                                key=${i}
                                                href=${link.url} 
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="w-full text-center px-3 py-2 ${link.variant || 'bg-gray-700/80'} text-white rounded-lg shadow hover:bg-opacity-90 transition flex items-center justify-center gap-2"
                                            >
                                                ${link.text}
                                            </a>
                                        `)}
                                    </div>
                                ` : ''}
                            </div>
                        `)}
                    </div>
                </div>
            `;
        };

        const Footer = () => html`
            <footer className="text-center text-xs text-gray-600 mt-auto pt-4">
                <p>BatDashboard ¬© 2025. Todos os direitos reservados.</p>
                <p>Criado por Pedro Victor Veras</p>
            </footer>
        `;

        // =======================================================
        // WIDGETS
        // =======================================================

        // --- Widget: Skills PVRV ---
        const SkillsWidget = () => {
            const { 
                skillsData, 
                xpPercentage, 
                xpToNextLevel, 
                unlockSkill, 
                completeRoutine,
                resetDailyRoutines,
                completeObjective 
            } = useSkillsController();

            const SkillCategory = ({ category }) => html`
                <div className="skill-card bg-black/30 p-4 rounded-lg">
                    <h3 className="font-bold text-gray-200 mb-2">${category.name}</h3>
                    <div className="flex justify-between items-center mb-2">
                        <span className="text-sm text-gray-400">Progresso</span>
                        <span className="text-sm font-semibold">${category.unlocked}/${category.total}</span>
                    </div>
                    <div className="w-full bg-gray-800 rounded-full h-2">
                        <div 
                            className="h-2 rounded-full xp-progress-bar" 
                            style=${{ width: `${(category.unlocked / category.total) * 100}%` }}>
                        </div>
                    </div>
                </div>
            `;

            const UnlockedSkillCard = ({ skill }) => html`
                <div className="skill-card unlocked bg-black/30 p-3 rounded-lg">
                    <div className="flex justify-between items-start">
                        <div>
                            <h4 className="font-bold text-green-400">${skill.name}</h4>
                            <p className="text-xs text-gray-400 mt-1">${skill.description}</p>
                        </div>
                        <span className="text-xs bg-green-900/30 text-green-400 px-2 py-1 rounded">N√≠vel ${skill.level}/${skill.maxLevel}</span>
                    </div>
                </div>
            `;

            const AvailableSkillCard = ({ skill }) => {
                const canUnlock = skillsData.improvementPoints > 0 && 
                                skillsData.currentXP >= skill.xpCost && 
                                skillsData.level >= skill.requiredLevel;
                
                return html`
                    <div className=${`skill-card ${canUnlock ? 'unlocked' : 'locked'} bg-black/30 p-3 rounded-lg cursor-pointer hover:bg-black/40`}
                         onClick=${() => canUnlock && unlockSkill(skill.id)}>
                        <div className="flex justify-between items-start">
                            <div>
                                <h4 className="font-bold ${canUnlock ? 'text-cyan-300' : 'text-gray-500'}">${skill.name}</h4>
                                <p className="text-xs text-gray-400 mt-1">${skill.description}</p>
                            </div>
                            <div className="text-right">
                                <div className="text-xs ${canUnlock ? 'text-cyan-400' : 'text-gray-500'}">${skill.xpCost} XP</div>
                                <div className="text-xs text-gray-500 mt-1">N√≠vel ${skill.requiredLevel}+</div>
                            </div>
                        </div>
                        ${!canUnlock ? html`
                            <div className="text-xs text-red-400 mt-2">
                                ${skillsData.level < skill.requiredLevel ? 'N√≠vel insuficiente' : 
                                  skillsData.currentXP < skill.xpCost ? 'XP insuficiente' : 
                                  'Pontos insuficientes'}
                            </div>
                        ` : ''}
                    </div>
                `;
            };

            const RoutineCard = ({ routine }) => html`
                <div className="skill-card bg-black/30 p-3 rounded-lg">
                    <div className="flex justify-between items-start mb-2">
                        <h4 className="font-bold text-gray-200">${routine.name}</h4>
                        <span className="routine-time text-xs">${routine.time}</span>
                    </div>
                    <ul className="space-y-1 mb-3">
                        ${routine.tasks.map((task, i) => html`
                            <li key=${i} className="text-sm text-gray-400 flex items-center">
                                <span className="mr-2">‚Ä¢</span> ${task}
                            </li>
                        `)}
                    </ul>
                    <button 
                        onClick=${() => completeRoutine(routine.id)}
                        disabled=${routine.completed}
                        className=${`w-full py-2 rounded-md text-sm font-medium transition ${routine.completed ? 'bg-green-900/30 text-green-400 cursor-not-allowed' : 'bg-cyan-600 hover:bg-cyan-700 text-white'}`}
                    >
                        ${routine.completed ? '‚úÖ Conclu√≠do' : 'Marcar como Conclu√≠do (+250 XP)'}
                    </button>
                </div>
            `;

            const ObjectiveCard = ({ objective }) => html`
                <div className="skill-card bg-black/30 p-3 rounded-lg">
                    <div className="flex justify-between items-start mb-2">
                        <div>
                            <h4 className="font-bold text-gray-200">${objective.name}</h4>
                            <p className="text-xs text-gray-400 mt-1">${objective.description}</p>
                        </div>
                        <span className="text-xs bg-cyan-900/30 text-cyan-400 px-2 py-1 rounded">+${objective.xpReward} XP</span>
                    </div>
                    
                    ${objective.current !== undefined ? html`
                        <div className="mb-2">
                            <div className="flex justify-between text-xs text-gray-400 mb-1">
                                <span>Progresso</span>
                                <span>${objective.current}/${objective.target}</span>
                            </div>
                            <div className="w-full bg-gray-800 rounded-full h-2">
                                <div 
                                    className="h-2 rounded-full xp-progress-bar" 
                                    style=${{ width: `${(objective.current / objective.target) * 100}%` }}>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <button 
                        onClick=${() => completeObjective(objective.id)}
                        disabled=${objective.completed || (objective.current !== undefined && objective.current < objective.target)}
                        className=${`w-full py-2 rounded-md text-sm font-medium transition ${objective.completed ? 'bg-green-900/30 text-green-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                    >
                        ${objective.completed ? '‚úÖ Objetivo Conclu√≠do' : 'Reivindicar Recompensa'}
                    </button>
                </div>
            `;

            return html`
                <div className="w-full h-full p-4 overflow-y-auto">
                    <div className="max-w-6xl mx-auto space-y-6">
                        <!-- XP Progress Bar -->
                        <div className="glass-panel !bg-black/20 p-4">
                            <div className="flex justify-between items-center mb-2">
                                <h2 className="text-2xl font-bold text-cyan-300">Habilidades PVRV ü¶á</h2>
                                <div className="text-right">
                                    <div className="text-lg font-bold text-green-400">N√≠vel ${skillsData.level}</div>
                                    <div className="text-sm text-gray-400">${skillsData.improvementPoints} Ponto(s) de Melhoria</div>
                                </div>
                            </div>
                            
                            <div className="mb-4">
                                <div className="flex justify-between mb-1">
                                    <span className="text-gray-300">Progresso do N√≠vel</span>
                                    <span className="text-gray-300">${skillsData.currentXP}/${skillsData.totalXP} XP (${xpPercentage}%)</span>
                                </div>
                                <div className="w-full bg-black/40 rounded-full h-4">
                                    <div 
                                        className="h-4 rounded-full xp-progress-bar" 
                                        style=${{ width: `${xpPercentage}%` }}>
                                    </div>
                                </div>
                                <div className="text-right text-sm text-gray-400 mt-1">
                                    ${xpToNextLevel} XP para o pr√≥ximo n√≠vel
                                </div>
                            </div>
                        </div>

                        <!-- Skill Categories -->
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${skillsData.skillCategories.map(category => html`
                                <${SkillCategory} key=${category.id} category=${category} />
                            `)}
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Left Column -->
                            <div className="space-y-6">
                                <!-- Unlocked Skills -->
                                <div className="glass-panel !bg-black/20 p-4">
                                    <h3 className="text-lg font-semibold text-green-400 mb-3">‚úÖ Habilidades Desbloqueadas</h3>
                                    <div className="space-y-3">
                                        ${skillsData.unlockedSkills.map(skill => html`
                                            <${UnlockedSkillCard} key=${skill.id} skill=${skill} />
                                        `)}
                                    </div>
                                </div>

                                <!-- Available Skills -->
                                <div className="glass-panel !bg-black/20 p-4">
                                    <h3 className="text-lg font-semibold text-cyan-300 mb-3">üÜï Habilidades Dispon√≠veis</h3>
                                    <p className="text-sm text-gray-400 mb-3">Clique em uma habilidade para desbloquear usando pontos de melhoria</p>
                                    <div className="space-y-3">
                                        ${skillsData.availableSkills.map(skill => html`
                                            <${AvailableSkillCard} key=${skill.id} skill=${skill} />
                                        `)}
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column -->
                            <div className="space-y-6">
                                <!-- Daily Routines -->
                                <div className="glass-panel !bg-black/20 p-4">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="text-lg font-semibold text-yellow-400">üìÖ Rotinas Di√°rias</h3>
                                        <button 
                                            onClick=${resetDailyRoutines}
                                            className="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded"
                                        >
                                            Resetar Rotinas
                                        </button>
                                    </div>
                                    <div className="space-y-3">
                                        ${skillsData.dailyRoutines.map(routine => html`
                                            <${RoutineCard} key=${routine.id} routine=${routine} />
                                        `)}
                                    </div>
                                </div>

                                <!-- Objectives -->
                                <div className="glass-panel !bg-black/20 p-4">
                                    <h3 className="text-lg font-semibold text-purple-400 mb-3">üéØ Objetivos</h3>
                                    <div className="space-y-3">
                                        ${skillsData.objectives.map(obj => html`
                                            <${ObjectiveCard} key=${obj.id} objective=${obj} />
                                        `)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        // --- Widget: Kanban ---
        const KanbanCard = ({ card, onDragStart }) => html`
            <div 
                draggable="true"
                onDragStart=${e => onDragStart(e, card.label)}
                className="bg-black/40 p-3 rounded-lg border border-gray-700 hover:border-cyan-400 transition cursor-grab active:cursor-grabbing">
                <h4 className="font-bold text-gray-200">${card.label}</h4>
                <p className="text-xs text-gray-400 mt-1">${card.items.filter(i => i.completed).length} / ${card.items.length} tarefas conclu√≠das</p>
                <div className="w-full bg-black/30 rounded-full h-1.5 mt-2">
                    <div className="h-1.5 rounded-full" style=${{ width: `${card.progress}%`, backgroundColor: card.color }}></div>
                </div>
            </div>`;

        const KanbanColumn = ({ title, cards, status, color, onDrop, onDragStart }) => {
            const [isOver, setIsOver] = useState(false);
            const handleDragOver = (e) => { e.preventDefault(); setIsOver(true); };
            const handleDragLeave = () => setIsOver(false);
            const handleDrop = (e) => { onDrop(e, status); setIsOver(false); };

            return html`
                <div 
                    onDragOver=${handleDragOver}
                    onDragLeave=${handleDragLeave}
                    onDrop=${handleDrop}
                    className=${`flex-1 min-w-[280px] bg-black/20 rounded-lg p-3 flex flex-col transition-colors ${isOver ? 'kanban-column-drag-over' : ''}`}>
                    <h3 className="font-bold text-lg px-2 pb-2 border-b-2" style=${{ borderColor: color }}>${title}</h3>
                    <div className="flex-1 pt-3 space-y-3 overflow-y-auto">
                        ${cards.map(card => html`<${KanbanCard} key=${card.label} card=${card} onDragStart=${onDragStart} />`)}
                    </div>
                </div>`;
        };

        const KanbanWidget = ({ tasks, onUpdate }) => {
            const onDragStart = (e, cardLabel) => {
                e.dataTransfer.setData("cardLabel", cardLabel);
            };

            const onDrop = (e, newStatus) => {
                const cardLabel = e.dataTransfer.getData("cardLabel");
                onUpdate(cardLabel, newStatus);
            };

            const columns = {
                BACKLOG: tasks.filter(t => t.status === 'BACKLOG'),
                TODO: tasks.filter(t => t.status === 'TODO'),
                IN_PROGRESS: tasks.filter(t => t.status === 'IN_PROGRESS'),
                COMPLETED: tasks.filter(t => t.status === 'COMPLETED')
            };
            const columnMeta = {
                BACKLOG: { title: 'BACKLOG', color: 'var(--kanban-backlog)' },
                TODO: { title: 'A FAZER', color: 'var(--kanban-todo)' },
                IN_PROGRESS: { title: 'EM ANDAMENTO', color: 'var(--kanban-progress)' },
                COMPLETED: { title: 'CONCLU√çDO', color: 'var(--kanban-completed)' }
            };

            return html`
                <div className="w-full h-full p-4 flex gap-4 overflow-x-auto">
                    ${Object.entries(columnMeta).map(([status, meta]) => html`
                        <${KanbanColumn} 
                            key=${status} 
                            title=${meta.title} 
                            cards=${columns[status] || []} 
                            status=${status}
                            color=${meta.color}
                            onDragStart=${onDragStart}
                            onDrop=${onDrop}
                        />
                    `)}
                </div>`;
        };

        // --- Widget: Orbit ---
        const OrbitWidget = () => {
            const simRef = useRef(null);
            const [target, setTarget] = useState('sun');
            useEffect(() => {
                const container = document.getElementById('simulation-container');
                if (container) simRef.current = mountPhysicsOrbitSystem(container);
                return () => { if (simRef.current?.stop) simRef.current.stop(); };
            }, []);
            useEffect(() => {
                if (simRef.current?.setCameraTarget) simRef.current.setCameraTarget(target);
            }, [target]);
            return html`
                <div className="w-full h-full relative">
                    <div id="simulation-container" className="w-full h-full absolute top-0 left-0"></div>
                    <div className="absolute top-2 left-2 md:top-4 md:left-4 glass-panel !p-1 md:!p-2 flex gap-1 md:gap-2">
                        <button onClick=${() => setTarget('sun')} className=${`px-2 py-1 rounded-md md:px-3 text-xs md:text-sm transition ${target === 'sun' ? 'bg-cyan-500 text-black font-semibold' : 'bg-black/40 hover:bg-black/60'}`}>Vis√£o: Sol ‚òÄÔ∏è</button>
                        <button onClick=${() => setTarget('earth')} className=${`px-2 py-1 rounded-md md:px-3 text-xs md:text-sm transition ${target === 'earth' ? 'bg-cyan-500 text-black font-semibold' : 'bg-black/40 hover:bg-black/60'}`}>Vis√£o: Terra üåç</button>
                    </div>
                </div>`;
        };

        // Simulation logic (Three.js) reused from original files
        const SOLAR_SYSTEM_DATA = new Map([
            ['sun', { name: 'Sol', radius: 4.5, color: 0xffcc33, isStar: true }],
            ['earth', { name: 'Terra', radius: 0.8, color: 0x2288ff, orbit: { radius: 25.0, period: 365 } }],
            ['mars', { name: 'Marte', radius: 0.45, color: 0xff5733, orbit: { radius: 38.0, period: 687 } }],
            ['moon', { name: 'Lua', radius: 0.25, color: 0xaaaaaa, orbit: { radius: 2.5, period: 27, center: 'earth' } }]
        ]);

        class OrbitalMechanics {
            static calculateSpeed(period, timeScale = 0.005) {
                if (!period) return 0;
                return timeScale * (365 / period);
            }
            static calculatePosition(angle, radius) {
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                return new THREE.Vector3(x, 0, z);
            }
        }

        function mountPhysicsOrbitSystem(container) {
            if (!container) {
                console.error("Cont√™iner da simula√ß√£o n√£o encontrado.");
                return { stop: () => { }, setCameraTarget: () => { } };
            }
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 2000);
            camera.position.set(0, 40, 70);

            const controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; controls.minDistance = 10; controls.maxDistance = 200;

            try {
                new THREE.TextureLoader().load(
                    'https://s3-us-west-2.amazonaws.com/s.cdpn.io/17271/star-field.png',
                    texture => { scene.background = texture; },
                    undefined,
                    error => { console.warn("N√£o foi poss√≠vel carregar a textura de fundo:", error); }
                );
            } catch (e) {
                console.warn("Erro ao iniciar o carregador de textura:", e);
            }

            const starVertices = Array.from({ length: 15000 }, () => THREE.MathUtils.randFloatSpread(2000));
            const starGeometry = new THREE.BufferGeometry();
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            scene.add(new THREE.Points(starGeometry, new THREE.PointsMaterial({ color: 0xffffff, size: 0.7 })));

            scene.add(new THREE.AmbientLight(0xffffff, 0.2));

            const celestialObjects = new Map();
            const orbitalStates = new Map();

            SOLAR_SYSTEM_DATA.forEach((data, id) => {
                const material = data.isStar
                    ? new THREE.MeshBasicMaterial({ color: data.color })
                    : new THREE.MeshStandardMaterial({ color: data.color, roughness: 0.6 });
                const mesh = new THREE.Mesh(new THREE.SphereGeometry(data.radius, 32, 32), material);
                scene.add(mesh);
                celestialObjects.set(id, mesh);

                if (data.isStar) {
                    scene.add(new THREE.PointLight(0xffddaa, 2.5, 1000));
                }

                if (data.orbit) {
                    orbitalStates.set(id, { angle: Math.random() * Math.PI * 2, speed: OrbitalMechanics.calculateSpeed(data.orbit.period) });
                    const orbitLine = new THREE.Line(
                        new THREE.BufferGeometry().setFromPoints(
                            Array.from({ length: 129 }, (_, i) => {
                                const theta = (i / 128) * Math.PI * 2;
                                return new THREE.Vector3(Math.cos(theta) * data.orbit.radius, 0, Math.sin(theta) * data.orbit.radius);
                            })
                        ),
                        new THREE.LineBasicMaterial({ color: data.color, transparent: true, opacity: 0.4 })
                    );
                    if (data.orbit.center && celestialObjects.get(data.orbit.center)) {
                        celestialObjects.get(data.orbit.center).add(orbitLine);
                    } else {
                        scene.add(orbitLine);
                    }
                }
            });

            let running = true;
            let targetObject = celestialObjects.get('sun');

            function animate() {
                if (!running) return;
                requestAnimationFrame(animate);

                orbitalStates.forEach((state, id) => {
                    state.angle += state.speed;
                    const data = SOLAR_SYSTEM_DATA.get(id);
                    const object = celestialObjects.get(id);
                    if (data && object) {
                        let position = OrbitalMechanics.calculatePosition(state.angle, data.orbit.radius);
                        if (data.orbit.center) {
                            const centerObject = celestialObjects.get(data.orbit.center);
                            if (centerObject) {
                                position.add(centerObject.position);
                            }
                        }
                        object.position.copy(position);
                    }
                });

                celestialObjects.forEach(obj => { obj.rotation.y += 0.005; });

                if (targetObject) {
                    controls.target.lerp(targetObject.position, 0.1);
                }
                controls.update();
                renderer.render(scene, camera);
            }
            animate();

            const onResize = () => {
                if (!container) return;
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            };
            window.addEventListener('resize', onResize);

            return {
                stop: () => {
                    running = false;
                    window.removeEventListener('resize', onResize);
                    if (container && renderer.domElement && renderer.domElement.parentNode === container) {
                        container.removeChild(renderer.domElement);
                    }
                    renderer.dispose(); controls.dispose();
                },
                setCameraTarget: (targetName) => {
                    const newTarget = celestialObjects.get(targetName);
                    if (newTarget) {
                        targetObject = newTarget;
                    }
                }
            };
        }

        // --- Widget: Markdown Viewer & Editor ---
        const renderMarkdownToHTML = (markdownText) => {
            if (!markdownText) return '';
            let html = String(markdownText);
            html = html.replace(/```([\s\S]*?)```/gim, (match, p1) => {
                const code = p1.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return `<pre class="bg-black/50 p-3 rounded-md overflow-x-auto my-4"><code class="font-mono text-sm">${code}</code></pre>`;
            });
            html = html.replace(/^# (.*$)/gim, '<h1 class="text-3xl font-bold neon-text mb-4 mt-6 pb-2 border-b border-gray-700">$1</h1>');
            html = html.replace(/^## (.*$)/gim, '<h2 class="text-2xl font-semibold text-cyan-300 mb-3 mt-5 pb-1 border-b border-gray-800">$1</h2>');
            html = html.replace(/^### (.*$)/gim, '<h3 class="text-xl font-semibold text-gray-300 mb-2 mt-4">$1</h3>');
            html = html.replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>');
            html = html.replace(/\*(.*?)\*/gim, '<em>$1</em>');
            html = html.replace(/__(.*?)__/gim, '<strong>$1</strong>');
            html = html.replace(/_(.*?)_/gim, '<em>$1</em>');
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/gim, '<a href="$2" target="_blank" rel="noopener noreferrer" class="text-cyan-400 hover:underline">$1</a>');
            html = html.replace(/`([^`]+)`/gim, '<code class="bg-black/50 px-2 py-1 rounded-md font-mono text-sm text-amber-300">$1</code>');
            // First handle all list items with checkboxes
            html = html.replace(/^\s*[-*]\s*(\[([ xX])\])\s*(.+)$/gm, (match, checkbox, state, text) => {
                const isChecked = state.trim().toLowerCase() === 'x';
                if (isChecked) {
                    return `<li class="flex items-center mb-2">
                        <span class="inline-block w-4 h-4 border-0 border-cyan-500 rounded-sm mr-3 bg-cyan-500 text-black flex items-center justify-center font-bold flex-shrink-0">
                            ‚úì
                        </span>
                        <span class="line-through text-gray-500">${text}</span>
                    </li>`;
                } else {
                    return `<li class="flex items-center mb-2">
                        <span class="inline-block w-4 h-4 border-2 border-gray-500 rounded-sm mr-3 bg-gray-700 flex-shrink-0"></span>
                        <span>${text}</span>
                    </li>`;
                }
            });

            // Then handle regular list items (without checkboxes)
            html = html.replace(/^\s*[-*]\s+(?!\[([ xX])\])([^\n]+)$/gm, (match, text) => {
                return `<li class="ml-6 list-disc marker:text-cyan-400 mb-2">${match.replace(/^\s*[-*]\s+/, '')}</li>`;
            });
            html = html.replace(/((?:<li[\s\S]*?<\/li>\s*)+)/gim, (match) => {
                if (match.includes('<ul') || match.includes('<ol')) return match;
                return `<ul class="space-y-1 mb-4">${match}</ul>`;
            });
            html = html.replace(/<ul>\s*(<ul[\s\S]*?<\/ul>)\s*<\/ul>/gim, '$1');
            html = html.replace(/^---\s*$/gim, '<hr class="border-gray-700 my-6">');
            html = html.replace(/^===\s*$/gim, '<hr class="border-cyan-500 my-6">');
            html = html.replace(/^> (.*$)/gim, '<blockquote class="border-l-4 border-gray-600 pl-4 italic text-gray-400 my-4">$1</blockquote>');
            html = html.split(/\n\n+/).map(paragraph => {
                const trimmedP = paragraph.trim();
                if (trimmedP.startsWith('<') || trimmedP === '') {
                    return paragraph;
                }
                const pContent = trimmedP.replace(/\n/g, '<br>');
                return `<p class="text-gray-300 leading-relaxed mb-4">${pContent}</p>`;
            }).join('');
            html = html.replace(/<br>\s*(<(h1|h2|h3|ul|li|pre|hr|blockquote))/gim, '$1');
            html = html.replace(/(<\/(h1|h2|h3|ul|li|pre|hr|blockquote)>)\s*<br>/gim, '$1');
            html = html.replace(/<p>\s*<\/p>/gim, '');
            return html;
        };

        const MarkdownViewerWidget = ({ markdownText }) => {
            const htmlContent = useMemo(() => renderMarkdownToHTML(markdownText), [markdownText]);
            return html`
                <div 
                    className="w-full h-full p-4 md:p-8 overflow-y-auto markdown-view"
                    dangerouslySetInnerHTML=${{ __html: htmlContent }}
                >
                </div>
            `;
        };

        const MarkdownEditorWidget = ({ markdown, onChange }) => {
            return html`
                <div className="w-full h-full p-2 md:p-4 flex flex-col">
                    <h3 className="text-lg font-semibold text-gray-300 mb-2">üìù Editor de Tarefas (Markdown)</h3>
                    <p className="text-sm text-gray-400 mb-4">Adicione tags como __TODO ou __IN_PROGRESS no final dos t√≠tulos (#) para organizar o Kanban.</p>
                    <textarea 
                        className="w-full h-full flex-1 p-3 rounded-md markdown-editor focus:outline-none focus:ring-2 focus:ring-[var(--neon-cyan)]" 
                        value=${markdown} 
                        onChange=${onChange}>
                    </textarea>
                </div>
            `;
        };

        // =======================================================
        // ! MODELOS (MVC) - PERFIL BATMAN
        // =======================================================

        class BatmanProfileModel {
            constructor() {
                this.profileData = {
                    basicInfo: {
                        nomeVerdadeiro: "Bruce Wayne",
                        ocupacao: "Vigilante",
                        base: "Gotham City",
                        corOlhos: "Azuis",
                        corCabelo: "Preto",
                        altura: "1,88 m",
                        peso: "91 kg"
                    },
                    progress: {
                        perfis: { current: 16, total: 32, percent: 50 },
                        arquivosAudio: { current: 0, total: 29, percent: 0 }
                    },
                    notes: [
                        { id: 1, text: "Monitorar atividade do Coringa no Asilo Arkham", date: "2024-02-05", category: "urgente" },
                        { id: 2, text: "Atualizar sistema de defesa da Batcaverna", date: "2024-02-04", category: "tecnologia" },
                        { id: 3, text: "Treinamento noturno com Tim Drake", date: "2024-02-03", category: "treinamento" },
                        { id: 4, text: "Investigar novo fluxo de Venom na cidade", date: "2024-02-02", category: "investiga√ß√£o" }
                    ],
                    goals: [
                        { id: 1, name: "Desvendar caso do Charada", progress: 75, deadline: "2024-03-01" },
                        { id: 2, name: "Aprimorar Batm√≥vel", progress: 40, deadline: "2024-02-20" },
                        { id: 3, name: "Treinar nova t√©cnica de combate", progress: 60, deadline: "2024-02-15" },
                        { id: 4, name: "Digitalizar arquivos antigos", progress: 25, deadline: "2024-03-15" }
                    ],
                    stats: {
                        forca: 95,
                        agilidade: 90,
                        inteligencia: 98,
                        resistencia: 92,
                        estrategia: 96,
                        sigilo: 94
                    },
                    missions: [
                        { id: 1, name: "Patrulha noturna", status: "concluido" },
                        { id: 2, name: "An√°lise forense", status: "em_andamento" },
                        { id: 3, name: "Monitoramento GCPD", status: "pendente" },
                        { id: 4, name: "Manuten√ß√£o equipamentos", status: "pendente" }
                    ]
                };
            }

            getProfileData() {
                return this.profileData;
            }

            addNote(noteText) {
                const newNote = {
                    id: Date.now(),
                    text: noteText,
                    date: new Date().toISOString().split('T')[0],
                    category: "geral"
                };
                this.profileData.notes.unshift(newNote);
                return this.profileData.notes;
            }

            deleteNote(noteId) {
                this.profileData.notes = this.profileData.notes.filter(note => note.id !== noteId);
                return this.profileData.notes;
            }

            updateGoalProgress(goalId, newProgress) {
                const goal = this.profileData.goals.find(g => g.id === goalId);
                if (goal) {
                    goal.progress = Math.min(100, Math.max(0, newProgress));
                }
                return this.profileData.goals;
            }
        }

        function useBatmanProfileController() {
            const [model] = useState(() => new BatmanProfileModel());
            const [activeProfileTab, setActiveProfileTab] = useState('info');
            const [profileData, setProfileData] = useState(model.getProfileData());
            const [newNote, setNewNote] = useState('');

            const handleAddNote = () => {
                if (newNote.trim()) {
                    const updatedNotes = model.addNote(newNote.trim());
                    setProfileData(prev => ({ ...prev, notes: updatedNotes }));
                    setNewNote('');
                }
            };

            const handleDeleteNote = (noteId) => {
                const updatedNotes = model.deleteNote(noteId);
                setProfileData(prev => ({ ...prev, notes: updatedNotes }));
            };

            const handleUpdateGoal = (goalId, progress) => {
                const updatedGoals = model.updateGoalProgress(goalId, progress);
                setProfileData(prev => ({ ...prev, goals: updatedGoals }));
            };

            const getCategoryColor = (category) => {
                switch(category) {
                    case 'urgente': return 'bg-red-900/30 text-red-300';
                    case 'tecnologia': return 'bg-blue-900/30 text-blue-300';
                    case 'treinamento': return 'bg-green-900/30 text-green-300';
                    case 'investiga√ß√£o': return 'bg-purple-900/30 text-purple-300';
                    default: return 'bg-gray-900/30 text-gray-300';
                }
            };

            const getStatusColor = (status) => {
                switch(status) {
                    case 'concluido': return 'bg-green-900/30 text-green-400';
                    case 'em_andamento': return 'bg-yellow-900/30 text-yellow-400';
                    case 'pendente': return 'bg-gray-900/30 text-gray-400';
                    default: return 'bg-gray-900/30';
                }
            };

            return {
                profileData,
                activeProfileTab,
                setActiveProfileTab,
                newNote,
                setNewNote,
                handleAddNote,
                handleDeleteNote,
                handleUpdateGoal,
                getCategoryColor,
                getStatusColor
            };
        }

        // =======================================================
        // ! COMPONENTES TAILWIND (PERFIL)
        // =======================================================

        const InfoCard = ({ title, children, className = '' }) => html`
            <div className=${`batman-card p-4 ${className}`}>
                <h3 className="font-bold text-lg mb-3 text-yellow-400 border-b border-yellow-800 pb-2">${title}</h3>
                ${children}
            </div>
        `;

        const ProgressBar = ({ label, current, total, percent, color = 'batman-progress-bar' }) => html`
            <div className="mb-4">
                <div className="flex justify-between mb-1">
                    <span className="text-gray-300">${label}</span>
                    <span className="text-yellow-400 font-mono">${current}/${total} (${percent}%)</span>
                </div>
                <div className="w-full bg-gray-800 rounded-full h-3">
                    <div 
                        className="h-3 rounded-full ${color}" 
                        style=${{ width: `${percent}%` }}>
                    </div>
                </div>
            </div>
        `;

        const StatCard = ({ label, value }) => html`
            <div className="bg-black/40 p-3 rounded-lg border border-gray-800">
                <div className="text-xs text-gray-400 mb-1">${label}</div>
                <div className="flex items-center">
                    <div className="flex-1">
                        <div className="w-full bg-gray-800 rounded-full h-2">
                            <div 
                                className="h-2 rounded-full bg-yellow-500" 
                                style=${{ width: `${value}%` }}>
                            </div>
                        </div>
                    </div>
                    <div className="ml-2 text-yellow-400 font-bold">${value}</div>
                </div>
            </div>
        `;

        const NoteCard = ({ note, onDelete, getCategoryColor }) => html`
            <div className="batman-card p-4">
                <div className="flex justify-between items-start mb-2">
                    <div className="flex-1">
                        <p className="text-gray-300">${note.text}</p>
                        <div className="flex items-center mt-2">
                            <span className="text-xs text-gray-500">${note.date}</span>
                            <span className=${`ml-2 text-xs px-2 py-1 rounded ${getCategoryColor(note.category)}`}>
                                ${note.category}
                            </span>
                        </div>
                    </div>
                    <button 
                        onClick=${() => onDelete(note.id)}
                        className="ml-2 text-red-400 hover:text-red-300"
                    >
                        √ó
                    </button>
                </div>
            </div>
        `;

        const GoalCard = ({ goal, onUpdate, getStatusColor }) => {
            const handleProgressChange = (e) => {
                const newProgress = parseInt(e.target.value);
                onUpdate(goal.id, newProgress);
            };

            return html`
                <div className="batman-card p-4">
                    <div className="flex justify-between items-center mb-3">
                        <h4 className="font-bold text-gray-200">${goal.name}</h4>
                        <span className="text-xs text-yellow-400">${goal.deadline}</span>
                    </div>
                    
                    <div className="mb-3">
                        <div className="flex justify-between mb-1">
                            <span className="text-sm text-gray-400">Progresso</span>
                            <span className="text-sm font-bold text-yellow-400">${goal.progress}%</span>
                        </div>
                        <div className="w-full bg-gray-800 rounded-full h-3">
                            <div 
                                className="h-3 rounded-full batman-progress-bar" 
                                style=${{ width: `${goal.progress}%` }}>
                            </div>
                        </div>
                    </div>
                    
                    <input 
                        type="range" 
                        min="0" 
                        max="100" 
                        value=${goal.progress}
                        onChange=${handleProgressChange}
                        className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                    />
                    
                    <div className="flex justify-between text-xs text-gray-500 mt-1">
                        <span>0%</span>
                        <span>100%</span>
                    </div>
                </div>
            `;
        };

        // =======================================================
        // ! WIDGET DO PERFIL BATMAN
        // =======================================================

        const BatmanProfileWidget = () => {
            const {
                profileData,
                activeProfileTab,
                setActiveProfileTab,
                newNote,
                setNewNote,
                handleAddNote,
                handleDeleteNote,
                handleUpdateGoal,
                getCategoryColor,
                getStatusColor
            } = useBatmanProfileController();

            const renderInfoTab = () => html`
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Informa√ß√µes B√°sicas -->
                    <${InfoCard} title="INFORMA√á√ïES">
                        <table className="w-full">
                            <tbody>
                                ${Object.entries(profileData.basicInfo).map(([key, value]) => html`
                                    <tr key=${key} className="border-b border-gray-800 last:border-0">
                                        <td className="py-2 text-gray-400 capitalize">${key.replace(/([A-Z])/g, ' $1')}</td>
                                        <td className="py-2 text-right text-gray-200">${value}</td>
                                    </tr>
                                `)}
                            </tbody>
                        </table>
                    <//>

                    <!-- Progresso -->
                    <${InfoCard} title="PROGRESSO">
                        <${ProgressBar} 
                            label="PERFIS" 
                            current=${profileData.progress.perfis.current}
                            total=${profileData.progress.perfis.total}
                            percent=${profileData.progress.perfis.percent}
                        />
                        <${ProgressBar} 
                            label="ARQUIVOS DE AUDIO" 
                            current=${profileData.progress.arquivosAudio.current}
                            total=${profileData.progress.arquivosAudio.total}
                            percent=${profileData.progress.arquivosAudio.percent}
                        />
                        
                        <!-- C√≥digo Bin√°rio -->
                        <div className="mt-6 p-3 bg-black/30 rounded-lg border border-gray-800">
                            <div className="batman-binary text-center text-sm">
                                0101 1101 E
                            </div>
                            <div className="text-center text-xs text-gray-500 mt-1">
                                Sistema de identifica√ß√£o Batman
                            </div>
                        </div>
                    <//>

                    <!-- Estat√≠sticas -->
                    <${InfoCard} title="ESTAT√çSTICAS" className="lg:col-span-2">
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                            ${Object.entries(profileData.stats).map(([key, value]) => html`
                                <${StatCard} 
                                    key=${key}
                                    label=${key.toUpperCase()}
                                    value=${value}
                                />
                            `)}
                        </div>
                    <//>

                    <!-- Miss√µes -->
                    <${InfoCard} title="MISS√ïES ATIVAS" className="lg:col-span-2">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            ${profileData.missions.map(mission => html`
                                <div key=${mission.id} className="flex justify-between items-center p-3 bg-black/40 rounded-lg">
                                    <div>
                                        <span className="text-gray-200">${mission.name}</span>
                                    </div>
                                    <span className=${`text-xs px-3 py-1 rounded-full ${getStatusColor(mission.status)}`}>
                                        ${mission.status.replace('_', ' ').toUpperCase()}
                                    </span>
                                </div>
                            `)}
                        </div>
                    <//>
                </div>
            `;

            const renderNotesTab = () => html`
                <div className="space-y-6">
                    <!-- Adicionar Nova Nota -->
                    <${InfoCard} title="ADICIONAR NOTA">
                        <div className="flex gap-2">
                            <input
                                type="text"
                                value=${newNote}
                                onChange=${e => setNewNote(e.target.value)}
                                placeholder="Digite uma nova nota..."
                                className="flex-1 bg-black/40 border border-gray-700 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:border-yellow-500"
                                onKeyPress=${e => e.key === 'Enter' && handleAddNote()}
                            />
                            <button
                                onClick=${handleAddNote}
                                className="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition"
                            >
                                Adicionar
                            </button>
                        </div>
                    <//>

                    <!-- Lista de Notas -->
                    <${InfoCard} title="NOTAS">
                        <div className="space-y-4">
                            ${profileData.notes.length === 0 ? html`
                                <div className="text-center py-8 text-gray-500">
                                    Nenhuma nota encontrada
                                </div>
                            ` : profileData.notes.map(note => html`
                                <${NoteCard} 
                                    key=${note.id}
                                    note=${note}
                                    onDelete=${handleDeleteNote}
                                    getCategoryColor=${getCategoryColor}
                                />
                            `)}
                        </div>
                    <//>
                </div>
            `;

            const renderGoalsTab = () => html`
                <div className="space-y-6">
                    <!-- Metas -->
                    <${InfoCard} title="METAS">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${profileData.goals.map(goal => html`
                                <${GoalCard} 
                                    key=${goal.id}
                                    goal=${goal}
                                    onUpdate=${handleUpdateGoal}
                                    getStatusColor=${getStatusColor}
                                />
                            `)}
                        </div>
                    <//>

                    <!-- Resumo de Progresso -->
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <${InfoCard} title="PROGRESSO TOTAL">
                            <div className="text-center py-4">
                                <div className="text-3xl font-bold text-yellow-400">
                                    ${Math.round(profileData.goals.reduce((sum, goal) => sum + goal.progress, 0) / profileData.goals.length)}%
                                </div>
                                <div className="text-sm text-gray-400 mt-2">M√©dia de Conclus√£o</div>
                            </div>
                        <//>
                        
                        <${InfoCard} title="METAS ATIVAS">
                            <div className="text-center py-4">
                                <div className="text-3xl font-bold text-yellow-400">
                                    ${profileData.goals.length}
                                </div>
                                <div className="text-sm text-gray-400 mt-2">Metas em Andamento</div>
                            </div>
                        <//>
                        
                        <${InfoCard} title="PR√ìXIMO PRAZO">
                            <div className="text-center py-4">
                                <div className="text-xl font-bold text-yellow-400">
                                    ${profileData.goals.sort((a, b) => new Date(a.deadline) - new Date(b.deadline))[0]?.deadline || 'N/A'}
                                </div>
                                <div className="text-sm text-gray-400 mt-2">Data Limite</div>
                            </div>
                        <//>
                    </div>
                </div>
            `;

            const renderProfileTab = () => html`
                <div className="space-y-6">
                    <!-- Perfil Completo -->
                    <${InfoCard} title="PERFIL COMPLETO">
                        <div className="space-y-4">
                            <div className="flex items-center space-x-4">
                                <div className="w-16 h-16 bg-yellow-900/30 rounded-full flex items-center justify-center text-2xl">
                                    ü¶á
                                </div>
                                <div>
                                    <h3 className="text-xl font-bold text-yellow-400">Bruce Wayne / Batman</h3>
                                    <p className="text-gray-400">O Cavaleiro das Trevas</p>
                                </div>
                            </div>
                            
                            <div className="border-t border-gray-800 pt-4">
                                <h4 className="font-bold text-gray-300 mb-2">DESCRI√á√ÉO</h4>
                                <p className="text-gray-400 leading-relaxed">
                                    Batman √© o alter-ego de Bruce Wayne, um bilion√°rio, playboy e filantropo. 
                                    Ap√≥s testemunhar o assassinato de seus pais quando crian√ßa, Wayne jurou vingan√ßa 
                                    contra os criminosos e treinou f√≠sica e intelectualmente para criar uma persona 
                                    inspirada em morcegos para combater o crime em Gotham City.
                                </p>
                            </div>
                        </div>
                    <//>

                    <!-- Habilidades -->
                    <${InfoCard} title="HABILIDADES">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            ${[
                                "Mestre em artes marciais",
                                "Detetive especialista",
                                "Estrategista brilhante",
                                "Hacker e t√©cnico",
                                "Especialista em furtividade",
                                "Perito em interrogat√≥rio"
                            ].map(skill => html`
                                <div key=${skill} className="flex items-center p-3 bg-black/40 rounded-lg">
                                    <span className="text-yellow-400 mr-2">‚úì</span>
                                    <span className="text-gray-300">${skill}</span>
                                </div>
                            `)}
                        </div>
                    <//>

                    <!-- Equipamentos -->
                    <${InfoCard} title="EQUIPAMENTOS">
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                            ${[
                                { name: "Batarang", icon: "‚öîÔ∏è" },
                                { name: "Traje", icon: "ü¶á" },
                                { name: "Cinto Utilidades", icon: "üîß" },
                                { name: "Batm√≥vel", icon: "üöó" },
                                { name: "Batcomputador", icon: "üíª" },
                                { name: "Bat-sinal", icon: "üî¶" },
                                { name: "Batwing", icon: "‚úàÔ∏è" },
                                { name: "Bat-caverna", icon: "üè∞" }
                            ].map(item => html`
                                <div key=${item.name} className="text-center p-3 bg-black/40 rounded-lg">
                                    <div className="text-2xl mb-1">${item.icon}</div>
                                    <div className="text-sm text-gray-300">${item.name}</div>
                                </div>
                            `)}
                        </div>
                    <//>
                </div>
            `;

            return html`
                <div className="w-full h-full p-4 overflow-y-auto">
                    <div className="max-w-7xl mx-auto">
                        <!-- Cabe√ßalho -->
                        <div className="batman-card p-6 mb-6">
                            <div className="flex flex-col md:flex-row md:items-center justify-between">
                                <div>
                                    <h1 className="text-2xl font-bold text-yellow-400">ü¶á BANCO DE DADOS - PERFIL BATMAN</h1>
                                    <p className="text-gray-400 mt-1">Sistema de gerenciamento do Cavaleiro das Trevas</p>
                                </div>
                                <div className="mt-4 md:mt-0 text-right">
                                    <div className="text-lg font-mono text-yellow-400">
                                        ${DashboardAppWidget.formatTime(new Date())}
                                    </div>
                                    <div className="text-sm text-gray-400">
                                        ${DashboardAppWidget.formatDate(new Date())}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Barra de Navega√ß√£o do Perfil -->
                        <div className="flex flex-wrap gap-2 mb-6">
                            ${['info', 'notas', 'metas', 'perfil'].map(tab => html`
                                <button
                                    key=${tab}
                                    onClick=${() => setActiveProfileTab(tab)}
                                    className=${`profile-tab-btn ${activeProfileTab === tab ? 'active' : ''}`}
                                >
                                    ${tab === 'info' ? 'üìä Info' : 
                                      tab === 'notas' ? 'üìù Notas' : 
                                      tab === 'metas' ? 'üéØ Metas' : 
                                      'ü¶á Perfil'}
                                </button>
                            `)}
                        </div>

                        <!-- Conte√∫do da Aba -->
                        <div className="batman-card p-6">
                            ${activeProfileTab === 'info' && renderInfoTab()}
                            ${activeProfileTab === 'notas' && renderNotesTab()}
                            ${activeProfileTab === 'metas' && renderGoalsTab()}
                            ${activeProfileTab === 'perfil' && renderProfileTab()}
                        </div>

                        <!-- Rodap√© -->
                        <div className="mt-6 text-center text-xs text-gray-600">
                            <p>Sistema Batman ¬© 2024. Todos os direitos reservados.</p>
                            <p>Gotham City Database v1.0</p>
                        </div>
                    </div>
                </div>
            `;
        };

        // =======================================================
        // ! DASHBOARD PRINCIPAL (INTEGRA PERFIL COMO ABA)
        // =======================================================

        function DashboardPainelPage() {
            const { activeView, setActiveView, currentTime, tasks, tasksMarkdown, handleMarkdownChange, handleKanbanUpdate } = useDashboardController();
            const [isDrawerOpen, setIsDrawerOpen] = useState(false);

            const TABS = useMemo(() => [
                { id: 'kanban', label: 'üóÇÔ∏è KanbanPro' },
                { id: 'orbit', label: 'üõ∞Ô∏è Sistema Orbital' },
                { id: 'skills', label: 'ü¶á Habilidades PVRV' },
                { id: 'batman-profile', label: 'ü¶á Perfil Batman' },
                { id: 'checklist', label: '‚úÖ Checklist' },
                { id: 'tasks', label: 'üìä Gr√°fico' },
                { id: 'view-markdown', label: 'üìÑ Visualizador' },
                { id: 'manage-tasks', label: 'üìù Editor' },
            ], []);

            const activeWidget = useMemo(() => {
                switch (activeView) {
                    case 'kanban':
                        return html`<${KanbanWidget} tasks=${tasks} onUpdate=${handleKanbanUpdate} />`;
                    case 'orbit':
                        return html`<${OrbitWidget} />`;
                    case 'skills':
                        return html`<${SkillsWidget} />`;
                    case 'batman-profile':
                        return html`<${BatmanProfileWidget} />`;
                    case 'checklist':
                        return html`<${ChecklistWidget} tasks=${tasks} />`;
                    case 'tasks':
                        return html`<${ChartWidget} data=${tasks} />`;
                    case 'view-markdown':
                        return html`<${MarkdownViewerWidget} markdownText=${tasksMarkdown} />`;
                    case 'manage-tasks':
                        return html`<${MarkdownEditorWidget} markdown=${tasksMarkdown} onChange=${handleMarkdownChange} />`;
                    default:
                        return html`<div className="p-4">Visualiza√ß√£o n√£o encontrada</div>`;
                }
            }, [activeView, tasks, tasksMarkdown, handleKanbanUpdate, handleMarkdownChange]);

            return html`
                <div className="h-dvh w-screen flex flex-col lg:flex-row gap-4 p-2 md:p-4">
                    
                    ${isDrawerOpen && html`
                        <div 
                            className="fixed inset-0 bg-black/60 z-40 lg:hidden"
                            onClick=${() => setIsDrawerOpen(false)}
                        ></div>
                    `}

                    <!-- Sidebar -->
                    <aside 
                        className=${`
                            fixed top-0 left-0 h-full w-80 max-w-full 
                            lg:static lg:h-auto lg:w-1/3 lg:max-w-md 
                            glass-panel p-4 flex flex-col gap-4 overflow-y-auto 
                            z-50 transition-transform transform 
                            ${isDrawerOpen ? 'translate-x-0' : '-translate-x-full'} 
                            lg:translate-x-0
                        `}
                    >
                         <${Header} currentTime=${currentTime} />
                        
                        <div className="flex-1 min-h-0 bg-black/20 p-3 rounded-lg overflow-y-auto space-y-4">
                            <${WeeklyFocus} tasks=${tasks} />
                            <p>Aqui entra alguns informa√ß√µes pegando o Pikachu Flask API sobre o dia de hoje e requisi√ß√µes GET de API</p>
                        </div>

                        <${LinksPanel} />
                        <${Footer} />
                    </aside>
                    
                    <!-- Painel Principal -->
                    <main className="h-3/5 lg:h-auto flex-1 min-h-0 lg:min-w-0 glass-panel flex flex-col p-0">
                        <!-- Navega√ß√£o das Abas -->
                        <nav className="flex-shrink-0 border-b border-[var(--border-color)] px-2 flex items-center">
                            
                            <!-- --- BOT√ÉO DE HAMB√öRGUER --- -->
                            <button 
                                onClick=${() => setIsDrawerOpen(true)} 
                                className="p-2 rounded-md hover:bg-black/20 lg:hidden mr-2 text-gray-400 hover:text-white"
                                aria-label="Abrir menu"
                            >
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                            </button>

                            <div className="flex space-x-2 overflow-x-auto">${TABS.map(tab => html`
                                <button key=${tab.id} onClick=${() => { setActiveView(tab.id); setIsDrawerOpen(false); }} className=${`tab-btn ${activeView === tab.id ? 'active' : ''}`}>${tab.label}</button>
                            `)}</div>
                        </nav>
                        
                        <!-- Conte√∫do da Aba (Widget Ativo) -->
                        <div className="flex-1 relative min-h-0">
                            ${activeWidget}
                        </div>
                    </main>
                </div>`;
        }

        // =======================================================
        // RENDER APPLICATION
        // =======================================================

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(html`<${DashboardPainelPage} />`);
    </script>
</body>
</html>



